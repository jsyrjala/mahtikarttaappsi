<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script src="jquery-2.1.3.js"></script>
    </head>
    <body>

        <h1>WebSocket</h1>

        <button id="open">Avaa</button>
        <button id="close">Sulje</button>
        <br/>
        <input size="50" type="text" id="text" value='{"subscribe": "trackers", "ids": [1,2]}'/>
        <button id="send">Lähetä</button>

        <script>
            var ws;
            function openWs() {
                ws = new WebSocket('ws://localhost:3100/ws');
                console.log(ws);
                ws.onerror = function(error) {
                    console.error(error);
                };
                ws.onmessage = function(message) {
                    console.info('Got message', message.data);
                };
                ws.onclose = function(msg) {
                    console.info('close', msg);
                };
                ws.onopen = function(msg) {
                    console.info('open', msg);
                };
            }
            $('#open').click(function(e) {
                console.info('Open WebSocket');
                openWs();
            })
            $('#close').click(function(){
                ws.close();
            });
            openWs();
            $('#send').click(function() {
                var msg = $('#text').val();
                console.debug('Send message:', msg);
                ws.send(msg);

            });
        </script>


    </body>
</html>
